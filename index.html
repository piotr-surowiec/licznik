<!doctype html>
<html lang="pl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Licznik">
  <title>≈öledzenie Czasu Pracy - Produkcja</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <!-- EKRAN 0: Dashboard (Wyb√≥r Linii) -->
    <div id="screen0" class="screen active">
      <div class="screen-header">
        <h1>üè≠ Panel Sterowania Liniami</h1>
        <div class="headerDateTime" style="text-align: center; font-size: 16px; font-weight: normal;">
          --.--.---- --:--:--
        </div>
      </div>

      <div id="linesGrid" class="dashboard-grid">
        <!-- Generowane przez JS -->
      </div>

      <div class="button-group" style="margin-top: 30px;">
        <button class="btn-primary" onclick="addNewLine()">‚ûï Dodaj Linie</button>
        <button class="btn-secondary" onclick="showScreen(3)">üìã Podsumowanie Dnia</button>
      </div>
    </div>

    <!-- EKRAN 1: Formularz startowy -->
    <div id="screen1" class="screen">
      <div class="screen-header">
        <div style="position: relative;">
          <button class="btn-secondary"
            style="position: absolute; left: 0; top: 0; padding: 5px 10px; font-size: 12px; margin-bottom: 5px;"
            onclick="showScreen(0)">‚¨Ö Wr√≥ƒá do Panelu</button>
          <h1>üìä ≈öledzenie Czasu Pracy</h1>
          <h2 style="border:none; margin:0; color:white; font-size:18px; text-align: center;">
            Produkcja - Etykietowanie
          </h2>
        </div>
        <div class="headerDateTime" style="text-align: center; font-size: 16px; font-weight: normal;">
          --.--.---- --:--:--
        </div>
      </div>

      <h2>üë§ Dane Pracownika</h2>


      <div class="form-group">
        <label for="workerName">Imiƒô i nazwisko <span class="required">*</span></label>
        <input type="text" id="workerName" required>
      </div>

      <div class="form-group">
        <label for="machine">Maszyna/Stanowisko <span class="required">*</span></label>
        <select id="machine" required>
          <option value="">-- Wybierz maszynƒô --</option>
        </select>
      </div>

      <div class="form-group">
        <label for="peopleCount">Ilo≈õƒá os√≥b na stanowisku <span class="required">*</span></label>
        <select id="peopleCount" required>
          <option value="">-- Wybierz ilo≈õƒá --</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </div>

      <div class="form-group">
        <label>Godzina rozpoczƒôcia <span class="required">*</span></label>
        <input type="text" id="startTimeDisplay" placeholder="Kliknij aby ustawiƒá godzinƒô" readonly
          onclick="openTimePicker()" style="cursor: pointer; text-align: center; font-weight: bold;">
        <input type="hidden" id="startTime">
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="startWorkDay()">Rozpocznij dzie≈Ñ pracy</button>
      </div>
    </div>

    <!-- EKRAN 2: Timer i rejestracja -->
    <div id="screen2" class="screen">
      <div class="screen-header">
        <div style="position: relative;">
          <button class="btn-secondary"
            style="position: absolute; left: 0; top: 0; padding: 5px 10px; font-size: 12px; margin-bottom: 5px;"
            onclick="showScreen(0)">‚¨Ö Wr√≥ƒá do Panelu</button>
          <h1>‚è±Ô∏è Etykietowanie</h1>
        </div>
        <div class="headerDateTime" style="text-align: center; font-size: 16px; font-weight: normal;">
          --.--.---- --:--:--
        </div>
      </div>

      <div class="user-info">
        <div class="info-item"><span class="info-label">Pracownik:</span> <span id="displayWorkerName"></span></div>
        <div class="info-item"><span class="info-label">Maszyna:</span> <span id="displayMachine"></span></div>
        <div class="info-item">
          <span class="info-label">Ilo≈õƒá os√≥b:</span> <span id="displayPeopleCount"></span>
          <button class="btn-primary" style="margin-left: 10px; padding: 6px 12px; min-width: auto; font-size: 14px;"
            onclick="openChangePeopleModal()">
            Zmie≈Ñ
          </button>
        </div>
        <div class="info-item">
          <span class="info-label">Bie≈ºƒÖcy produkt:</span> <span id="displayCurrentProduct">‚Äî</span>
        </div>
        <div class="info-item">
          <span class="info-label">Razem zaetykietowano:</span> <span id="totalLabeledDisplay">0 szt.</span>
        </div>
      </div>


      <div class="form-group">
        <label for="productSearch">Produkt do etykietowania <span class="required">*</span></label>
        <input type="text" id="productSearch" placeholder="üîç Wpisz aby wyszukaƒá produkt ..." oninput="filterProducts()"
          onfocus="showProductDropdown()" autocomplete="off" style="margin-bottom: 0; border-radius: 6px 6px 0 0;">
        <div id="productList"></div>
      </div>

      <div id="workTimerContainer" class="timer-container">
        <div class="timer-label">‚è±Ô∏è CZAS PRACY - Etykietowanie</div>
        <div id="workTimer" class="timer work timer-display">00:00:00</div>
      </div>

      <div class="button-group">
        <button id="startBtn" class="btn-success" onclick="startLabeling()" disabled>Start</button>
        <button id="breakBtn" class="btn-warning" onclick="startBreak()" disabled>Przerwa</button>
        <button id="stopBtn" class="btn-danger" onclick="stopLabeling()" disabled>Stop</button>
      </div>

      <div id="breakTimerContainer" class="timer-container hidden">
        <div class="timer-label">‚è∏Ô∏è CZAS PRZERWANIA PRACY</div>
        <div id="breakTimer" class="timer break timer-display">00:00:00</div>
        <div class="button-group">
          <button id="resumeBtn" class="btn-primary" onclick="resumeWork()">Wzn√≥w pracƒô</button>
        </div>
      </div>

      <!-- NOWA TABELA: Bie≈ºƒÖce przerwy w tej sesji -->
      <!-- USUNIƒòTO DUPLIKAT TABELI PRZERW -->
      <div class="input-grid">
        <div class="form-group" style="margin-bottom: 0;">
          <label for="quantityInput">Ilo≈õƒá zaetykietowana:<span class="required">*</span></label>
          <input type="number" id="quantityInput" min="1" placeholder="Wpisz ilo≈õƒá">
          <div id="quantityValidation" class="validation-message">Wymagane!</div>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
          <label for="labelTypeSelect">Rodzaj etykiety:<span class="required">*</span></label>
          <select id="labelTypeSelect">
            <option value="">-- Wybierz rodzaj --</option>
          </select>
          <div id="labelTypeValidation" class="validation-message">Wybierz!</div>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
          <label for="batchNumberInput">Data i nr partii:<span class="required">*</span></label>
          <input type="text" id="batchNumberInput" placeholder="DD.RRRR L.MM.DD">
          <div id="batchValidation" class="validation-message">Wymagane!</div>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
          <label for="productionDateInput">Data produkcji:<span class="required">*</span></label>
          <input type="date" id="productionDateInput">
          <div id="prodDateValidation" class="validation-message">Wybierz datƒô!</div>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
          <label for="cardNumberInput">Nr kart FO-18:<span class="required">*</span></label>
          <input type="text" id="cardNumberInput" placeholder="X/XX/XX/RRRR">
          <div id="cardValidation" class="validation-message">Wymagane!</div>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
          <label>Rodzaj Pakowania <span class="required">*</span></label>
          <div style="display: flex; gap: 20px; margin-top: 10px;">
            <label style="font-weight: normal; cursor: pointer;">
              <input type="radio" name="packagingType" value="Folia" onchange="saveState()" checked> Folia
            </label>
            <label style="font-weight: normal; cursor: pointer;">
              <input type="radio" name="packagingType" value="Karton" onchange="saveState()"> Karton
            </label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="notesInput">Uwagi (opcjonalne)</label>
        <textarea id="notesInput" rows="2" placeholder="Opcjonalne uwagi"></textarea>
      </div>

      <div id="breakModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">‚è∏Ô∏è Przyczyna przerwania pracy</div>

          <div class="form-group">
            <label for="breakReason">Wybierz przyczynƒô przerwy<span class="required">*</span></label>
            <select id="breakReason" onchange="handleBreakReasonChange()">
              <option value="">-- Wybierz --</option>
              <option value="Awaria">Awaria</option>
              <option value="Przerwa ≈õniadaniowa">Przerwa ≈õniadaniowa</option>
            </select>
          </div>

          <div class="form-group hidden" id="descriptionRequired">
            <label for="breakDescription">Opis awarii<span class="required">*</span></label>
            <textarea id="breakDescription" rows="3" placeholder="Opisz przyczynƒô przerwy"></textarea>
            <div id="breakValidation" class="validation-message">Opis awarii jest wymagany!</div>
          </div>

          <div class="button-group">
            <button class="btn-secondary" onclick="cancelBreak()">Anuluj</button>
            <button class="btn-primary" onclick="confirmBreak()">Potwierd≈∫</button>
          </div>
        </div>
      </div>

      <!-- Modal zmiany ilo≈õci os√≥b -->
      <div id="changePeopleModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">üë• Zmiana ilo≈õci os√≥b na stanowisku</div>
          <div class="form-group">
            <label for="newPeopleCount">Nowa ilo≈õƒá os√≥b <span class="required">*</span></label>
            <select id="newPeopleCount">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
            </select>
          </div>
          <div class="button-group">
            <button class="btn-secondary" onclick="cancelChangePeople()">Anuluj</button>
            <button class="btn-primary" onclick="confirmChangePeople()">OK</button>
          </div>
        </div>
      </div>



      <h2>Historia etykietowania - sesje pracy:</h2>
      <div class="table-container">
        <table id="labelingHistoryTable">
          <thead>
            <tr>
              <th>Lp.</th>
              <th>Produkt</th>
              <th>Data i nr partii</th>
              <th>Data produkcji</th>
              <th>Ilo≈õƒá os√≥b</th>
              <th>Nr kart FO-18</th>
              <th>Rodzaj etykiety</th>
              <th>Pakowanie</th>
              <th>Start</th>
              <th>Stop</th>
              <th>Czas (min)</th>
              <th>Sztuki</th>
              <th>Uwagi</th>
              <th>Przerwa (min)</th>
              <th>Norma</th>
            </tr>
          </thead>
          <tbody id="labelingHistoryBody">
            <tr class="empty-table">
              <td colspan="12">Brak sesji</td>
            </tr>
          </tbody>
        </table>
      </div>

      <h2>Historia przerw:</h2>
      <div class="table-container">
        <table id="breakHistoryTable">
          <thead>
            <tr>
              <th>Lp.</th>
              <th>ID sesji</th>
              <th>Start</th>
              <th>Stop</th>
              <th>Czas (min)</th>
              <th>Przyczyna</th>
              <th>Produkt</th>
            </tr>
          </thead>
          <tbody id="breakHistoryBody">
            <tr class="empty-table">
              <td colspan="7">Brak przerw</td>
            </tr>
          </tbody>
        </table>
      </div>

      <h2>Historia zmian ilo≈õci os√≥b:</h2>
      <div class="table-container">
        <table id="peopleChangeHistoryTable">
          <thead>
            <tr>
              <th>Lp.</th>
              <th>Poprzednia ilo≈õƒá</th>
              <th>Nowa ilo≈õƒá</th>
              <th>Data i godzina zmiany</th>
            </tr>
          </thead>
          <tbody id="peopleChangeHistoryBody">
            <tr class="empty-table">
              <td colspan="4">Brak zmian</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="button-group">
        <button class="btn-secondary" onclick="showScreen(3)">Podsumowanie Dnia</button>
      </div>
    </div>

    <!-- EKRAN 3: Globalne Podsumowanie -->
    <div id="screen3" class="screen">
      <div class="screen-header">
        <div style="position: relative;">
          <button class="btn-secondary" style="position: absolute; left: 0; top: 0; padding: 5px 10px; font-size: 12px;"
            onclick="showScreen(0)">‚¨Ö Wr√≥ƒá do Panelu</button>
          <h1>üìã Podsumowanie Dnia</h1>
        </div>
        <div class="headerDateTime" style="text-align: center; font-size: 16px; font-weight: normal;">
          --.--.---- --:--:--
        </div>
      </div>

      <!--<div class="user-info">
        <div class="info-item"><span class="info-label">Pracownik:</span> <span id="summaryWorkerName"></span></div>
        <div class="info-item"><span class="info-label">Maszyna:</span> <span id="summaryMachine"></span></div>
        <div class="info-item"><span class="info-label">Ilo≈õƒá os√≥b:</span> <span id="summaryPeopleCount"></span></div>
        <div class="info-item">
          <span class="info-label">Godziny pracy:</span> <span id="summaryWorkHours"></span>
        </div>
      </div>-->

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalSessions">0</div>
          <div class="stat-label">Sesji etykietowania</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalPieces">0</div>
          <div class="stat-label">Zaetykietowano sztuk</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalWorkMinutes">0</div>
          <div class="stat-label">Minut pracy</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalBreakMinutes">0</div>
          <div class="stat-label">Minut przerw</div>
        </div>
      </div>
      <h2>Historia etykietowania:</h2>
      <div class="table-container">
        <table id="summaryLabelingTable">
          <thead>
            <tr>
              <th>Lp.</th>
              <th>Linia</th>
              <th>Produkt</th>
              <th>Data i nr partii</th>
              <th>Data produkcji</th>
              <th>Ilo≈õƒá os√≥b</th>
              <th>Nr kart FO-18</th>
              <th>Rodzaj etykiety</th>
              <th>Pakowanie</th>
              <th>Start</th>
              <th>Stop</th>
              <th>Czas</th>
              <th>Sztuki</th>
              <th>Uwagi</th>
              <th>Przerwa</th>
              <th>Norma</th>
            </tr>
          </thead>
          <tbody id="summaryLabelingBody"></tbody>
        </table>
      </div>
      <h2>Historia przerw:</h2>
      <div class="table-container">
        <table id="summaryBreakHistoryTable">
          <thead>
            <tr>
              <th>Lp.</th>
              <th>Linia</th>
              <th>Produkt</th>
              <th>Sesja nr</th>
              <th>Rodzaj przerwy</th>
              <th>Start</th>
              <th>Stop</th>
              <th>Czas (min)</th>
              <th>Opis</th>
            </tr>
          </thead>
          <tbody id="summaryBreakHistoryBody">
            <tr class="empty-table">
              <td colspan="8">Brak przerw</td>
            </tr>
          </tbody>
        </table>
      </div>

      <h2>Historia zmian ilo≈õci os√≥b:</h2>
      <div class="table-container">
        <table id="summaryPeopleChangeTable">
          <thead>
            <tr>
              <th>Lp.</th>
              <th>Linia</th>
              <th>ID sesji</th>
              <th>Poprzednia ilo≈õƒá</th>
              <th>Nowa ilo≈õƒá</th>
              <th>Data i godzina zmiany</th>
            </tr>
          </thead>
          <tbody id="summaryPeopleChangeBody">
            <tr class="empty-table">
              <td colspan="4">Brak zmian</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="button-group">
        <button class="btn-secondary" onclick="showScreen(0)">‚Üê Wr√≥ƒá do Panelu</button>
        <button class="btn-primary" onclick="sendToGoogleSheets()">Wy≈õlij niezatwierdzone (Backup)</button>
        <button class="btn-reset" onclick="confirmStartNewDay()">Wyczy≈õƒá wszystko<br>i rozpocznij nowy dzie≈Ñ</button>
      </div>
    </div>
  </div>
  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(registration => {
          });
      });
    }
  </script>
  <!-- Time Picker Modal Moved to Body Level -->
  <div id="timePickerModal" class="modal">
    <div class="modal-content" style="max-width: 350px;">
      <div class="modal-header">‚è∞ Ustaw godzinƒô</div>

      <div style="display: flex; justify-content: space-around;">
        <div class="picker-label">Godzina</div>
        <div class="picker-label">Minuta</div>
      </div>

      <div class="picker-columns">
        <div class="picker-column" id="hourColumn">
          <!-- Hours generated by JS -->
        </div>
        <div class="picker-column" id="minuteColumn">
          <!-- Minutes generated by JS -->
        </div>
      </div>

      <div class="button-group">
        <button class="btn-secondary" onclick="closeTimePicker()">Anuluj</button>
        <button class="btn-primary" onclick="confirmTime()">Zatwierd≈∫</button>
      </div>
    </div>
  </div>
</body>

</html>